<!DOCTYPE HTML>

<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script></head>

<body>
    <div id="plot">
    </div>

    <div id="button">
        <button onclick="resample(d);">Resample</button>
    </div>

    <script>

     d = 50
     l = 0.04
     xs = math.zeros(d)

     for (let i = 0; i < d; i++) {
         xs.set([i], i / (d-1))
     }

     let Sigma = make_Sigma_RBF(l, d)
     let ys = random_multivariate_gaussian(Sigma)
     var trace = {x: xs.toArray(), y: ys, mode: 'line'};
     var data = [ trace ];
     Plotly.newPlot('plot', data);

     function resample(d) {
         let Sigma = make_Sigma_RBF(l, d)
         let ys = random_multivariate_gaussian(Sigma)
         Plotly.restyle('plot', 'y', [ys]);
     }

     function make_Sigma_RBF(l, d) {

         let Sigma = math.zeros(d, d);

         for (let i = 0; i < d; i++) {
             for (let j = 0; j < d; j++) {
                 let x = i / (d-1);
                 let y = j / (d-1);
                 let s = math.exp( -((x-y)**2) / (2 * (l ** 2)))
                 Sigma.set([i, j], s);
             }
         }

         return Sigma
     }

     function random_gaussian() {
         let u = Math.random();
         let v = Math.random();
         let z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
         return z
     }

     function random_multivariate_gaussian(Sigma) {

         let d = Sigma.size()[0]
         let ys = new Array(d);

         for (let j = 0; j < d; j++) {
             ys[j] = random_gaussian();
         }

         zs = math.multiply(math.sqrt(Sigma), ys)
         return zs.toArray()
     }

    </script>

</body>
